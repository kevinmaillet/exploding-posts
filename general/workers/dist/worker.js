!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */t.parse=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var n={},o=t||{},i=e.split(s),l=o.decode||r,u=0;u<i.length;u++){var c=i[u],f=c.indexOf("=");if(!(f<0)){var d=c.substr(0,f).trim(),p=c.substr(++f,c.length).trim();'"'==p[0]&&(p=p.slice(1,-1)),null==n[d]&&(n[d]=a(p,l))}}return n},t.serialize=function(e,t,n){var r=n||{},s=r.encode||o;if("function"!=typeof s)throw new TypeError("option encode is invalid");if(!i.test(e))throw new TypeError("argument name is invalid");var a=s(t);if(a&&!i.test(a))throw new TypeError("argument val is invalid");var l=e+"="+a;if(null!=r.maxAge){var u=r.maxAge-0;if(isNaN(u)||!isFinite(u))throw new TypeError("option maxAge is invalid");l+="; Max-Age="+Math.floor(u)}if(r.domain){if(!i.test(r.domain))throw new TypeError("option domain is invalid");l+="; Domain="+r.domain}if(r.path){if(!i.test(r.path))throw new TypeError("option path is invalid");l+="; Path="+r.path}if(r.expires){if("function"!=typeof r.expires.toUTCString)throw new TypeError("option expires is invalid");l+="; Expires="+r.expires.toUTCString()}r.httpOnly&&(l+="; HttpOnly");r.secure&&(l+="; Secure");if(r.sameSite){switch("string"==typeof r.sameSite?r.sameSite.toLowerCase():r.sameSite){case!0:l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"strict":l+="; SameSite=Strict";break;case"none":l+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return l};var r=decodeURIComponent,o=encodeURIComponent,s=/; */,i=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function a(e,t){try{return t(e)}catch(t){return e}}},function(e,t,n){"use strict";n.r(t);const r={"Content-type":"application-json","Access-Control-Allow-Origin":"https://posts-web.pages.dev","Access-Control-Allow-Methods":"GET,HEAD,POST,OPTIONS","Access-Control-Allow-Credentials":"true","Access-Control-Max-Age":"86400","Access-Control-Allow-Headers":"Content-Type, Authorization, X-Requested-With"},o=(e,t,n=r)=>({status:e,statusText:t,headers:n}),s=(e,t)=>({status:e,data:t}),i=(e,t)=>({status:e,errors:t});var a=n(0);const l="https://intellectual-saved-everyone-express.trycloudflare.com";async function u(e){const t=Object(a.parse)(e.headers.get("Cookie")||""),n=new URL(e.url),u=n.pathname;if(console.log(e.cf),console.log(n.port),console.log(n.host),"GET"===e.method&&"/posts"===u){let e=[];const{keys:t}=await POSTS.list();for(const n of t)e.push(await POSTS.get(n.name,{type:"json"}));const n=o(200,"OK"),r=s("OK",e);return new Response(JSON.stringify(r),n)}if("POST"===e.method&&"/posts"===u){const{title:n,username:u,content:c}=JSON.parse(await e.text());let f=((e,t)=>{let n=`${e}_${t}`;return n=n.replace(/\s+/g,"-").toLowerCase(),n})(u,n);if(!n||!u||!c){const e=o(400,"Bad Request"),t=i("Bad Request","Missing Data Fields");return new Response(JSON.stringify(t),e)}if(await POSTS.get(f)){const e=o(409,"Conflict"),t=i("Conflict","Post with that title and username already exists");return new Response(JSON.stringify(t),e)}if(await USERS.get(u.toLowerCase())){if(null!=t.token){const t=await fetch(l+"/verify",{headers:e.headers,method:"GET"}),a=await t.text();if("ExpiredSignature"===a){const e=o(401,"Unauthorized"),t=i("Unauthorized","Session expired. Use a new username.");return new Response(JSON.stringify(t),e)}if(a===u){await POSTS.put(f,JSON.stringify({title:n,username:u,content:c}));const e=o(201,"Created",r),t=s("Created Post",{title:n,username:u,content:c});return new Response(JSON.stringify(t),e)}}const a=o(409,"Conflict"),d=i("Conflict","User already taken.");return new Response(JSON.stringify(d),a)}await POSTS.put(f,JSON.stringify({title:n,username:u,content:c})),await USERS.put(u.toLowerCase(),"Valid User");let d=(e=>{const t=(e=e.split(" ")[0]).substring(e.indexOf("=")+1,e.lastIndexOf(";"));return Object(a.serialize)("token",t,{sameSite:"none",httpOnly:!0,secure:!0,path:"/",maxAge:86400})})((await fetch(`${l}/auth/${u}`)).headers.get("set-cookie"));const p=o(201,"Created",{"Set-Cookie":d,...r}),S=s("Created Post",{title:n,username:u,content:c});return new Response(JSON.stringify(S),p)}const c=o(404,"Not Found"),f=i("Bad Request","Resource could not be found");return new Response(JSON.stringify(f),c)}const c={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET,HEAD,POST,OPTIONS","Access-Control-Max-Age":"86400"};addEventListener("fetch",e=>{"OPTIONS"===e.request.method?e.respondWith(function(e){let t=e.headers;if(null!==t.get("Origin")&&null!==t.get("Access-Control-Request-Method")&&null!==t.get("Access-Control-Request-Headers")){let t={...c,"Access-Control-Allow-Headers":e.headers.get("Access-Control-Request-Headers")};return new Response(null,{headers:t})}return new Response(null,{headers:{Allow:"GET, HEAD, POST, OPTIONS"}})}(e.request)):e.respondWith(u(e.request))})}]);